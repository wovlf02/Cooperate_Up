# 보안 아키텍처 개요 (Security Architecture Overview)

## 1. 보안 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Client Layer                                    │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                        React Native App                                 │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │   Keychain   │  │  SSL Pinning │  │   App        │                 │ │
│  │  │  (iOS/AOS)   │  │  Certificate │  │  Obfuscation │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HTTPS/TLS 1.3 + WSS
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Network Layer (AWS)                                │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                    WAF (Web Application Firewall)                       │ │
│  │  - SQL Injection 방어  - XSS 방어  - Rate Limiting  - Bot 탐지         │ │
│  └────────────────────────────────┬───────────────────────────────────────┘ │
│                                   │                                          │
│  ┌────────────────────────────────┴───────────────────────────────────────┐ │
│  │                    Application Load Balancer                            │ │
│  │  - SSL Termination  - Health Check  - Sticky Session                   │ │
│  └────────────────────────────────┬───────────────────────────────────────┘ │
└───────────────────────────────────┼─────────────────────────────────────────┘
                                    │
┌───────────────────────────────────┼─────────────────────────────────────────┐
│                         Application Layer                                    │
│              ┌────────────────────┴────────────────────┐                    │
│              ▼                                         ▼                    │
│  ┌─────────────────────────┐           ┌─────────────────────────┐         │
│  │     Spring Boot API     │           │   Node.js Signaling     │         │
│  │                         │           │                         │         │
│  │  ┌───────────────────┐  │           │  ┌───────────────────┐  │         │
│  │  │  Spring Security  │  │           │  │   JWT Middleware  │  │         │
│  │  │  - JWT Filter     │  │           │  │   - Token Verify  │  │         │
│  │  │  - CORS Config    │  │           │  │   - Room Auth     │  │         │
│  │  │  - CSRF Disabled  │  │           │  └───────────────────┘  │         │
│  │  └───────────────────┘  │           │                         │         │
│  │  ┌───────────────────┐  │           │  ┌───────────────────┐  │         │
│  │  │  Input Validation │  │           │  │  Connection Guard │  │         │
│  │  │  - Bean Validation│  │           │  │  - Max Connections│  │         │
│  │  │  - Custom Sanitize│  │           │  │  - IP Throttling  │  │         │
│  │  └───────────────────┘  │           │  └───────────────────┘  │         │
│  │  ┌───────────────────┐  │           │                         │         │
│  │  │  Rate Limiter     │  │           │                         │         │
│  │  │  - Per User       │  │           │                         │         │
│  │  │  - Per Endpoint   │  │           │                         │         │
│  │  └───────────────────┘  │           │                         │         │
│  └───────────┬─────────────┘           └───────────┬─────────────┘         │
└──────────────┼─────────────────────────────────────┼────────────────────────┘
               │                                     │
┌──────────────┼─────────────────────────────────────┼────────────────────────┐
│              ▼              Data Layer             ▼                        │
│  ┌─────────────────────────┐           ┌─────────────────────────┐         │
│  │     PostgreSQL (RDS)    │           │    ElastiCache (Redis)  │         │
│  │                         │           │                         │         │
│  │  - 저장 암호화 (AES-256)│           │  - 암호화 전송          │         │
│  │  - SSL 연결 필수       │           │  - AUTH 토큰            │         │
│  │  - IAM 인증            │           │  - VPC 내부만 접근      │         │
│  │  - 자동 백업           │           │                         │         │
│  └─────────────────────────┘           └─────────────────────────┘         │
│                                                                              │
│  ┌─────────────────────────┐                                                │
│  │      Amazon S3          │                                                │
│  │                         │                                                │
│  │  - SSE-S3 암호화       │                                                │
│  │  - Presigned URL       │                                                │
│  │  - Bucket Policy       │                                                │
│  │  - 버전 관리           │                                                │
│  └─────────────────────────┘                                                │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 보안 계층별 책임

### 2.1 클라이언트 계층 (React Native)

| 보안 기능 | 구현 방법 | 목적 |
|----------|----------|------|
| 토큰 저장 | Keychain (iOS) / Keystore (Android) | 민감 정보 안전 저장 |
| SSL Pinning | 인증서 고정 | MITM 공격 방지 |
| 코드 난독화 | ProGuard / Hermes | 리버스 엔지니어링 방지 |
| 입력 검증 | 클라이언트 사전 검증 | 기본 필터링 |
| 화면 캡처 방지 | FLAG_SECURE | 민감 화면 보호 |

### 2.2 네트워크 계층 (AWS)

| 보안 기능 | 구현 방법 | 목적 |
|----------|----------|------|
| WAF | AWS WAF | 웹 공격 방어 |
| DDoS 방어 | AWS Shield | 서비스 가용성 보장 |
| TLS 암호화 | TLS 1.3 | 전송 중 데이터 보호 |
| VPC | Private Subnet | 네트워크 격리 |
| Security Group | 포트 기반 접근 제어 | 최소 포트 개방 |

### 2.3 애플리케이션 계층 (Spring Boot / Node.js)

| 보안 기능 | 구현 방법 | 목적 |
|----------|----------|------|
| 인증 | JWT + Spring Security | 사용자 신원 확인 |
| 인가 | RBAC + Custom Annotation | 권한 기반 접근 제어 |
| 입력 검증 | Bean Validation + Custom Validator | 악성 입력 차단 |
| Rate Limiting | Bucket4j / Redis | 과도한 요청 차단 |
| 로깅 | 보안 이벤트 기록 | 감사 추적 |

### 2.4 데이터 계층 (PostgreSQL / Redis / S3)

| 보안 기능 | 구현 방법 | 목적 |
|----------|----------|------|
| 저장 암호화 | AES-256 | 저장 데이터 보호 |
| 전송 암호화 | SSL/TLS | 전송 중 데이터 보호 |
| 접근 제어 | IAM + VPC | 최소 권한 접근 |
| 백업 | 자동화된 암호화 백업 | 데이터 복구 |

---

## 3. 보안 흐름 (Security Flow)

### 3.1 인증 흐름

```
┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐
│  Client  │      │   ALB    │      │  Spring  │      │ Database │
│   App    │      │  + WAF   │      │   Boot   │      │   (RDS)  │
└────┬─────┘      └────┬─────┘      └────┬─────┘      └────┬─────┘
     │                 │                 │                 │
     │ 1. Login Request│                 │                 │
     │ (HTTPS)         │                 │                 │
     │────────────────>│                 │                 │
     │                 │ 2. WAF Check    │                 │
     │                 │ (Rate Limit)    │                 │
     │                 │────────────────>│                 │
     │                 │                 │ 3. Query User   │
     │                 │                 │────────────────>│
     │                 │                 │                 │
     │                 │                 │<────────────────│
     │                 │                 │ 4. User Data    │
     │                 │                 │                 │
     │                 │                 │ 5. Verify       │
     │                 │                 │    Password     │
     │                 │                 │    (BCrypt)     │
     │                 │                 │                 │
     │                 │                 │ 6. Generate JWT │
     │                 │                 │    (Access +    │
     │                 │                 │     Refresh)    │
     │                 │                 │                 │
     │                 │                 │ 7. Store Refresh│
     │                 │                 │    in Redis     │
     │                 │                 │                 │
     │                 │<────────────────│                 │
     │<────────────────│ 8. JWT Tokens   │                 │
     │                 │                 │                 │
     │ 9. Store in     │                 │                 │
     │    Keychain     │                 │                 │
     │                 │                 │                 │
```

### 3.2 API 요청 흐름

```
┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐
│  Client  │      │   ALB    │      │  Spring  │      │ Database │
│   App    │      │  + WAF   │      │   Boot   │      │          │
└────┬─────┘      └────┬─────┘      └────┬─────┘      └────┬─────┘
     │                 │                 │                 │
     │ 1. API Request  │                 │                 │
     │ Authorization:  │                 │                 │
     │ Bearer {token}  │                 │                 │
     │────────────────>│                 │                 │
     │                 │ 2. WAF Rules    │                 │
     │                 │    Check        │                 │
     │                 │────────────────>│                 │
     │                 │                 │                 │
     │                 │                 │ 3. JWT Filter   │
     │                 │                 │ - Verify Token  │
     │                 │                 │ - Check Expiry  │
     │                 │                 │ - Load User     │
     │                 │                 │                 │
     │                 │                 │ 4. Authorization│
     │                 │                 │ - Check Role    │
     │                 │                 │ - Check Access  │
     │                 │                 │                 │
     │                 │                 │ 5. Rate Limit   │
     │                 │                 │    Check        │
     │                 │                 │                 │
     │                 │                 │ 6. Input        │
     │                 │                 │    Validation   │
     │                 │                 │                 │
     │                 │                 │ 7. Business     │
     │                 │                 │    Logic        │
     │                 │                 │────────────────>│
     │                 │                 │                 │
     │                 │                 │<────────────────│
     │<────────────────│<────────────────│ 8. Response     │
     │                 │                 │                 │
```

---

## 4. 위협 모델 (Threat Model)

### 4.1 STRIDE 분석

| 위협 유형 | 설명 | 대응 방안 |
|----------|------|----------|
| **S**poofing (위장) | 다른 사용자로 위장 | JWT 인증, 토큰 검증 |
| **T**ampering (변조) | 데이터 무단 수정 | 입력 검증, 서명 |
| **R**epudiation (부인) | 행위 부인 | 감사 로깅 |
| **I**nformation Disclosure (정보 노출) | 민감 정보 유출 | 암호화, 접근 제어 |
| **D**enial of Service (서비스 거부) | 서비스 마비 | Rate Limiting, WAF |
| **E**levation of Privilege (권한 상승) | 무단 권한 획득 | RBAC, 권한 검증 |

### 4.2 주요 위협 시나리오

| 시나리오 | 위험도 | 대응 방안 |
|---------|--------|----------|
| 토큰 탈취 | High | 짧은 만료, Refresh Token 회전 |
| SQL Injection | Critical | Prepared Statement, 입력 검증 |
| XSS 공격 | High | 출력 인코딩, CSP |
| CSRF 공격 | Medium | 토큰 기반 인증 (쿠키 미사용) |
| Brute Force | High | Rate Limiting, 계정 잠금 |
| Man-in-the-Middle | High | TLS 1.3, SSL Pinning |

---

## 5. 컴플라이언스

### 5.1 법적 요구사항

| 법규 | 관련 조항 | 대응 방안 |
|------|----------|----------|
| 개인정보보호법 | 제24조 (고유식별정보) | 암호화 저장 |
| 개인정보보호법 | 제29조 (안전조치) | 보안 시스템 구축 |
| 위치정보보호법 | 제16조 (보호조치) | 위치정보 암호화 |
| 전자서명법 | 제3조 (효력) | 전자서명 무결성 |
| 근로기준법 | 제17조 (근로계약서) | 계약서 보관 |

### 5.2 보안 인증 고려사항

| 인증 | 설명 | 적용 시기 |
|------|------|----------|
| ISMS-P | 정보보호관리체계 | 사용자 확대 시 |
| ISO 27001 | 정보보안경영시스템 | 기업 고객 확보 시 |
| SOC 2 Type II | 서비스 보안 감사 | 글로벌 확장 시 |

