# 보안 사고 대응 (Incident Response)

## 1. 사고 대응 체계

### 1.1 대응 조직

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        사고 대응 조직도                                   │
│                                                                          │
│                    ┌─────────────────────┐                              │
│                    │   사고 대응 총괄    │                              │
│                    │   (Security Lead)   │                              │
│                    └──────────┬──────────┘                              │
│                               │                                          │
│         ┌─────────────────────┼─────────────────────┐                   │
│         │                     │                     │                   │
│         ▼                     ▼                     ▼                   │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐            │
│  │   기술 대응   │     │   운영 대응   │     │   커뮤니케이션 │            │
│  │    (Dev)     │     │   (DevOps)   │     │     (PM)     │            │
│  └──────────────┘     └──────────────┘     └──────────────┘            │
│        │                     │                     │                    │
│        ▼                     ▼                     ▼                    │
│  - 취약점 분석         - 시스템 격리          - 내부 보고              │
│  - 코드 패치           - 로그 수집            - 고객 통보              │
│  - 긴급 배포           - 시스템 복구          - 언론 대응              │
│                        - 증거 보존            - 법적 보고              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 연락망

| 역할 | 담당자 | 연락처 | 대체 담당자 |
|------|--------|--------|------------|
| Security Lead | - | - | - |
| Backend Lead | - | - | - |
| DevOps Lead | - | - | - |
| PM | - | - | - |
| Legal | - | - | - |

---

## 2. 사고 등급 분류

### 2.1 등급 정의

| 등급 | 설명 | 예시 | 대응 시간 |
|------|------|------|----------|
| **Critical** | 서비스 전체 장애 또는 대규모 데이터 유출 | 데이터베이스 해킹, 인증 우회 | 즉시 (30분 내) |
| **High** | 중요 기능 장애 또는 제한적 데이터 유출 | 특정 사용자 정보 유출, 권한 상승 | 1시간 내 |
| **Medium** | 일부 기능 장애 또는 잠재적 보안 위협 | XSS 발견, 비정상 트래픽 | 4시간 내 |
| **Low** | 경미한 영향 또는 정보성 보안 이슈 | 약한 암호화, 로그 부족 | 24시간 내 |

### 2.2 등급별 에스컬레이션

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        에스컬레이션 매트릭스                              │
│                                                                          │
│  Critical ──▶ Security Lead ──▶ CTO ──▶ CEO                            │
│               (즉시)          (30분)   (1시간)                          │
│                                                                          │
│  High ────▶ Security Lead ──▶ CTO                                      │
│             (1시간)          (4시간)                                    │
│                                                                          │
│  Medium ──▶ Security Lead                                               │
│             (4시간)                                                      │
│                                                                          │
│  Low ─────▶ 담당 개발자 ──▶ Security Lead                              │
│             (24시간)        (필요 시)                                   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 사고 대응 프로세스

### 3.1 대응 단계

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        사고 대응 프로세스                                 │
│                                                                          │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │  탐지    │───▶│  분류    │───▶│  격리    │───▶│  분석    │          │
│  │ Detect   │    │ Classify │    │ Contain  │    │ Analyze  │          │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘          │
│                                                        │                 │
│                                                        ▼                 │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │  개선    │◀───│  보고    │◀───│ 서비스   │◀───│  복구    │          │
│  │ Improve  │    │ Report   │    │  재개    │    │ Recover  │          │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 단계별 상세 절차

#### 1단계: 탐지 (Detect)

```markdown
## 탐지 체크리스트

- [ ] 알람 출처 확인 (CloudWatch, WAF, 사용자 신고)
- [ ] 초기 영향 범위 파악
- [ ] 사고 등급 임시 분류
- [ ] Security Lead 알림
- [ ] 타임라인 기록 시작

## 탐지 경로
1. CloudWatch Alarm
2. WAF 차단 로그
3. 사용자 신고
4. 외부 제보 (버그바운티 등)
5. 정기 점검 중 발견
```

#### 2단계: 분류 (Classify)

```markdown
## 분류 기준

### 영향도 평가
- 영향 받은 사용자 수: ___명
- 유출된 데이터 유형: ___
- 서비스 영향: 전체 / 부분 / 없음
- 금전적 피해 가능성: 높음 / 중간 / 낮음

### 사고 유형
- [ ] 데이터 유출
- [ ] 서비스 거부 (DDoS)
- [ ] 무단 접근
- [ ] 악성코드 감염
- [ ] 내부자 위협
- [ ] 설정 오류

### 최종 등급: Critical / High / Medium / Low
```

#### 3단계: 격리 (Contain)

```bash
#!/bin/bash
# 긴급 격리 스크립트 예시

# 1. 의심스러운 IP 차단
aws wafv2 update-ip-set \
    --name bizone-blocked-ips \
    --scope REGIONAL \
    --id $IP_SET_ID \
    --addresses $MALICIOUS_IP/32

# 2. 특정 사용자 세션 무효화
redis-cli DEL "user_tokens:$USER_ID"

# 3. 영향 받은 서버 격리 (필요 시)
aws ec2 modify-instance-attribute \
    --instance-id $INSTANCE_ID \
    --groups $ISOLATED_SG_ID

# 4. 데이터베이스 스냅샷 생성 (증거 보존)
aws rds create-db-snapshot \
    --db-instance-identifier bizone-prod-db \
    --db-snapshot-identifier incident-$(date +%Y%m%d-%H%M%S)
```

#### 4단계: 분석 (Analyze)

```markdown
## 분석 항목

### 로그 수집
- [ ] CloudWatch Logs 추출
- [ ] VPC Flow Logs 추출
- [ ] WAF Logs 추출
- [ ] 애플리케이션 로그 추출
- [ ] 데이터베이스 감사 로그

### 분석 질문
1. 무엇이 발생했는가?
2. 언제 발생했는가? (타임라인)
3. 어떻게 발생했는가? (공격 벡터)
4. 누가 영향을 받았는가?
5. 현재 진행 중인가?

### 증거 보존
- [ ] 로그 파일 백업
- [ ] 시스템 스냅샷
- [ ] 네트워크 캡처 (필요 시)
- [ ] 해시 값 기록
```

#### 5단계: 복구 (Recover)

```markdown
## 복구 절차

### 시스템 복구
- [ ] 취약점 패치 적용
- [ ] 영향 받은 계정 비밀번호 리셋
- [ ] 모든 세션 무효화
- [ ] 보안 설정 강화
- [ ] 시스템 재시작

### 데이터 복구 (필요 시)
- [ ] 백업 무결성 확인
- [ ] 특정 시점 복구 (PITR)
- [ ] 데이터 무결성 검증

### 서비스 복구
- [ ] 스테이징 환경 테스트
- [ ] 단계적 서비스 재개
- [ ] 모니터링 강화
```

#### 6단계: 서비스 재개

```markdown
## 서비스 재개 체크리스트

- [ ] 취약점 완전 해결 확인
- [ ] 보안 테스트 통과
- [ ] 헬스체크 정상
- [ ] 모니터링 알람 정상
- [ ] 담당자 승인

## 재개 후 모니터링 (24시간)
- [ ] 트래픽 패턴 정상
- [ ] 에러율 정상
- [ ] 재발 징후 없음
```

#### 7단계: 보고 (Report)

```markdown
## 사고 보고서 템플릿

### 1. 개요
- 사고 ID: INC-YYYYMMDD-XXX
- 발생 일시: YYYY-MM-DD HH:MM
- 탐지 일시: YYYY-MM-DD HH:MM
- 해결 일시: YYYY-MM-DD HH:MM
- 사고 등급: Critical / High / Medium / Low

### 2. 영향
- 영향 받은 사용자: XX명
- 유출된 데이터: 
- 서비스 중단 시간: XX시간 XX분

### 3. 타임라인
| 시간 | 이벤트 | 조치 | 담당자 |
|------|--------|------|--------|
| HH:MM | ... | ... | ... |

### 4. 근본 원인 (Root Cause)
(원인 상세 설명)

### 5. 대응 조치
(수행한 조치 목록)

### 6. 재발 방지 대책
| 항목 | 담당자 | 완료 예정일 | 상태 |
|------|--------|-----------|------|
| ... | ... | ... | ... |

### 7. 교훈 (Lessons Learned)
(이번 사고에서 배운 점)
```

#### 8단계: 개선 (Improve)

```markdown
## 개선 활동

### 단기 (1주일 내)
- [ ] 긴급 패치 적용
- [ ] 모니터링 규칙 추가
- [ ] 접근 권한 재검토

### 중기 (1개월 내)
- [ ] 보안 정책 업데이트
- [ ] 교육/훈련 실시
- [ ] 도구/프로세스 개선

### 장기 (분기 내)
- [ ] 아키텍처 개선
- [ ] 보안 감사 실시
- [ ] 침투 테스트 실시
```

---

## 4. 사고 유형별 대응

### 4.1 데이터 유출

```markdown
## 데이터 유출 대응 절차

### 즉시 조치 (30분 내)
1. 유출 경로 차단
2. 영향 받은 계정 식별
3. 유출된 데이터 범위 파악

### 사용자 보호 조치
1. 영향 받은 사용자 비밀번호 강제 리셋
2. 모든 세션 무효화
3. 알림 발송

### 법적 조치 (개인정보 유출 시)
1. 개인정보보호위원회 신고 (72시간 내)
2. 정보주체 통지
3. 유출 피해 최소화 조치
```

### 4.2 DDoS 공격

```markdown
## DDoS 공격 대응 절차

### 즉시 조치
1. AWS Shield 상태 확인
2. WAF Rate Limiting 강화
3. CloudFront 캐싱 활용
4. 스케일링 조정

### 차단 조치
# 공격 IP 대역 차단
aws wafv2 update-ip-set --name blocked-ips --addresses $ATTACKER_CIDR

### AWS 지원 요청 (Shield Advanced 사용 시)
- DDoS Response Team 연락
- 공격 패턴 분석 요청
```

### 4.3 무단 접근

```markdown
## 무단 접근 대응 절차

### 즉시 조치
1. 해당 계정/세션 즉시 차단
2. 접근 경로 확인
3. 피해 범위 파악

### 조사
1. 로그인 기록 분석
2. 행위 로그 분석
3. 접근한 데이터 확인

### 복구
1. 비밀번호 변경 강제
2. 2FA 활성화 권고
3. 의심 활동 사용자 알림
```

### 4.4 취약점 발견

```markdown
## 취약점 발견 대응 절차

### 심각도 평가
- CVSS 점수 확인
- 악용 가능성 평가
- 영향 범위 파악

### 대응 우선순위
| CVSS | 등급 | 대응 시간 |
|------|------|----------|
| 9.0+ | Critical | 24시간 내 |
| 7.0-8.9 | High | 1주일 내 |
| 4.0-6.9 | Medium | 1개월 내 |
| 0.1-3.9 | Low | 다음 릴리스 |

### 패치 프로세스
1. 패치 개발
2. 스테이징 테스트
3. 보안 검증
4. 프로덕션 배포
5. 모니터링
```

---

## 5. 커뮤니케이션 템플릿

### 5.1 내부 알림

```
[긴급] 보안 사고 발생 알림

사고 등급: [Critical/High/Medium/Low]
발생 시간: YYYY-MM-DD HH:MM
현재 상태: [조사 중/격리 완료/복구 중/해결]

영향:
- [영향 내용]

현재 조치:
- [수행 중인 조치]

필요 조치:
- [팀별 필요 조치]

다음 업데이트: HH:MM
문의: [담당자]
```

### 5.2 고객 알림 (데이터 유출 시)

```
[중요] 개인정보 관련 안내

안녕하세요, Biz One입니다.

저희 서비스에서 보안 사고가 발생하여 안내드립니다.

■ 발생 일시: YYYY년 MM월 DD일

■ 영향 받은 정보:
- [유출된 정보 항목]

■ 저희가 취한 조치:
- [수행한 조치 내용]

■ 고객님께 권장드리는 조치:
- 비밀번호 변경
- [기타 권장 사항]

■ 문의처:
- 이메일: security@bizone.com
- 전화: XXX-XXXX-XXXX

저희는 고객님의 정보 보호를 위해 최선을 다하겠습니다.
불편을 드려 진심으로 사과드립니다.

Biz One 팀 드림
```

---

## 6. 사후 분석 (Post-Mortem)

### 6.1 분석 회의 아젠다

```markdown
## 사후 분석 회의

### 1. 사건 개요 (10분)
- 무엇이 발생했는가?
- 타임라인 리뷰

### 2. 영향 분석 (10분)
- 사용자 영향
- 비즈니스 영향
- 기술적 영향

### 3. 근본 원인 분석 (20분)
- 5 Whys 기법
- 기여 요인 식별

### 4. 대응 평가 (15분)
- 잘된 점
- 개선할 점
- 프로세스 갭

### 5. 재발 방지 대책 (20분)
- 단기 조치
- 중장기 조치
- 담당자 및 일정

### 6. 액션 아이템 정리 (10분)
```

### 6.2 5 Whys 분석 예시

```
문제: 데이터베이스에 무단 접근 발생

Why 1: 왜 무단 접근이 가능했는가?
→ 관리자 계정의 비밀번호가 유출됨

Why 2: 왜 비밀번호가 유출되었는가?
→ 피싱 이메일에 속아 자격 증명 입력

Why 3: 왜 피싱 이메일에 속았는가?
→ 보안 인식 교육 부족

Why 4: 왜 2FA가 무단 접근을 막지 못했는가?
→ 관리자 계정에 2FA가 비활성화되어 있었음

Why 5: 왜 2FA가 비활성화되어 있었는가?
→ 2FA 필수 정책이 없었음

근본 원인:
1. 보안 인식 교육 프로그램 부재
2. 관리자 계정 2FA 필수 정책 부재
```

---

## 7. 보안 체크리스트

### 7.1 사고 대응 역량 점검

| 항목 | 상태 | 비고 |
|------|:----:|------|
| 사고 대응 조직 구성 | ⬜ | |
| 연락망 최신화 | ⬜ | |
| 대응 절차 문서화 | ✅ | |
| 모의 훈련 실시 | ⬜ | 분기 1회 |
| 커뮤니케이션 템플릿 | ✅ | |
| 자동화 스크립트 | ⬜ | |
| 로그 보존 정책 | ⬜ | |
| 법적 자문 체계 | ⬜ | |

