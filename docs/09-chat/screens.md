# ğŸ“± ì±„íŒ… í™”ë©´

## ê°œìš”

ìŠ¤í„°ë”” ì±„íŒ… í™”ë©´ êµ¬ì„±ì…ë‹ˆë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `src/app/my-studies/[studyId]/chat/page.jsx`

---

## URL

`/my-studies/[studyId]/chat`

---

## ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [StudyTabs]                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“š ìŠ¤í„°ë”” ì´ë¦„                    ì˜¨ë¼ì¸: 3ëª…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ [ë©”ì‹œì§€ ëª©ë¡]                                    â”‚
â”‚                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ğŸ‘¤ í™ê¸¸ë™                      10:00        â”‚  â”‚
â”‚ â”‚ ì•ˆë…•í•˜ì„¸ìš”!                                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ğŸ‘¤ ê¹€ì² ìˆ˜                      10:01        â”‚  â”‚
â”‚ â”‚ ë°˜ê°‘ìŠµë‹ˆë‹¤                                  â”‚  â”‚
â”‚ â”‚ ğŸ“ document.pdf (125KB)                     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚ ê¹€ì² ìˆ˜ë‹˜ì´ ì…ë ¥ ì¤‘...                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“] [ë©”ì‹œì§€ ì…ë ¥ì°½]                  [ì „ì†¡] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ìƒíƒœ ê´€ë¦¬

```javascript
const [content, setContent] = useState('');
const [typingUsers, setTypingUsers] = useState([]);
const [selectedFile, setSelectedFile] = useState(null);
const [isUploading, setIsUploading] = useState(false);
const [contextMenu, setContextMenu] = useState(null);
const [editingMessage, setEditingMessage] = useState(null);
const [realtimeMessages, setRealtimeMessages] = useState([]);
```

---

## API í˜¸ì¶œ

```javascript
// ìŠ¤í„°ë”” ì •ë³´
const { data: studyData } = useStudy(studyId);

// ë©¤ë²„ ëª©ë¡
const { data: membersData } = useStudyMembers(studyId);

// ë©”ì‹œì§€ ëª©ë¡
const { data: messagesData, refetch: refetchMessages } = useMessages(studyId);

// ë©”ì‹œì§€ ì „ì†¡
const sendMessageMutation = useSendMessage();

// ë©”ì‹œì§€ ì‚­ì œ
const deleteMessageMutation = useDeleteMessage();
```

---

## Socket.IO ì—°ê²°

```javascript
const { socket, isConnected } = useSocket();

// ì±„íŒ…ë°© ì…ì¥
useEffect(() => {
  if (!socket || !studyId) return;
  
  socket.emit('study:join', { studyId });
  
  return () => {
    socket.emit('study:leave', { studyId });
  };
}, [socket, studyId]);

// ì‹¤ì‹œê°„ ë©”ì‹œì§€ ìˆ˜ì‹ 
useEffect(() => {
  if (!socket) return;

  const handleNewMessage = (message) => {
    if (message.senderId === currentUser.id) return;
    setRealtimeMessages(prev => [...prev, message]);
  };

  socket.on('message:new', handleNewMessage);
  
  return () => {
    socket.off('message:new', handleNewMessage);
  };
}, [socket, currentUser]);
```

---

## ë©”ì‹œì§€ ë³‘í•©

API ë©”ì‹œì§€ì™€ ì‹¤ì‹œê°„ ë©”ì‹œì§€ë¥¼ ë³‘í•©í•©ë‹ˆë‹¤.

```javascript
// API ë©”ì‹œì§€ ì •ê·œí™”
const apiMessages = (messagesData?.data || []).map(msg => ({
  ...msg,
  sender: msg.user || msg.sender,
  senderId: msg.userId || msg.senderId
}));

// ì¤‘ë³µ ì œê±°
const apiMessageIds = new Set(apiMessages.map(m => m.id));
const uniqueRealtimeMessages = realtimeMessages.filter(
  m => !apiMessageIds.has(m.id) && !m.id?.startsWith('temp-')
);

// ìµœì¢… ë©”ì‹œì§€ ëª©ë¡
const allMessages = [...apiMessages, ...uniqueRealtimeMessages];
```

---

## ì£¼ìš” ê¸°ëŠ¥

### ë©”ì‹œì§€ ì „ì†¡

```javascript
const handleSendMessage = async () => {
  if (!content.trim() && !selectedFile) return;

  try {
    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
    const tempMessage = {
      id: `temp-${Date.now()}`,
      content,
      sender: currentUser,
      createdAt: new Date().toISOString()
    };
    setRealtimeMessages(prev => [...prev, tempMessage]);
    
    // API í˜¸ì¶œ
    await sendMessageMutation.mutateAsync({
      studyId,
      content,
      fileId: selectedFile?.id
    });
    
    setContent('');
    setSelectedFile(null);
  } catch (error) {
    // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
  }
};
```

### íŒŒì¼ ì²¨ë¶€

```javascript
const handleFileSelect = async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  
  setIsUploading(true);
  try {
    const formData = new FormData();
    formData.append('file', file);
    
    const response = await api.post(`/studies/${studyId}/files`, formData);
    setSelectedFile(response.data.data);
  } catch (error) {
    alert('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
  } finally {
    setIsUploading(false);
  }
};
```

### ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´

ìš°í´ë¦­ ì‹œ ìˆ˜ì •/ì‚­ì œ ì˜µì…˜ í‘œì‹œ:

```javascript
const handleContextMenu = (e, message) => {
  e.preventDefault();
  
  // ë³¸ì¸ ë©”ì‹œì§€ì´ê±°ë‚˜ ê´€ë¦¬ìì¸ ê²½ìš°ë§Œ
  if (message.senderId !== currentUser.id && !isAdmin) return;
  
  setContextMenu({
    x: e.clientX,
    y: e.clientY,
    message
  });
};
```

### ë©”ì‹œì§€ ìˆ˜ì •

```javascript
const handleEditMessage = async () => {
  try {
    await api.patch(`/studies/${studyId}/chat/${editingMessage.id}`, {
      content: editingMessage.content
    });
    refetchMessages();
    setEditingMessage(null);
  } catch (error) {
    alert('ë©”ì‹œì§€ ìˆ˜ì • ì‹¤íŒ¨');
  }
};
```

### ë©”ì‹œì§€ ì‚­ì œ

```javascript
const handleDeleteMessage = async (messageId) => {
  if (!confirm('ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  try {
    await deleteMessageMutation.mutateAsync({ studyId, messageId });
    setRealtimeMessages(prev => prev.filter(m => m.id !== messageId));
  } catch (error) {
    alert('ë©”ì‹œì§€ ì‚­ì œ ì‹¤íŒ¨');
  }
};
```

### ìë™ ìŠ¤í¬ë¡¤

```javascript
const messagesEndRef = useRef(null);

const scrollToBottom = () => {
  messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
};

useEffect(() => {
  scrollToBottom();
}, [allMessages]);
```

---

## íƒ€ì´í•‘ í‘œì‹œ

```javascript
// íƒ€ì´í•‘ ì‹œì‘
const handleTypingStart = () => {
  socket?.emit('typing:start', { studyId, userId: currentUser.id });
};

// íƒ€ì´í•‘ ì¢…ë£Œ
const handleTypingStop = () => {
  socket?.emit('typing:stop', { studyId, userId: currentUser.id });
};

// íƒ€ì´í•‘ ìˆ˜ì‹ 
useEffect(() => {
  if (!socket) return;
  
  socket.on('user:typing', ({ userId, userName }) => {
    setTypingUsers(prev => [...prev, { userId, userName }]);
  });
  
  socket.on('user:stopTyping', ({ userId }) => {
    setTypingUsers(prev => prev.filter(u => u.userId !== userId));
  });
}, [socket]);
```

---

## ìŠ¤íƒ€ì¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `page.module.css` | ì±„íŒ… í˜ì´ì§€ ìŠ¤íƒ€ì¼ |

---

## ê´€ë ¨ ë¬¸ì„œ

- [API](./api.md)
- [ì˜ˆì™¸](./exceptions.md)
- [README](./README.md)

