# ğŸ“¹ í™”ìƒí†µí™” ë„ë©”ì¸

## ê°œìš”

WebRTC ê¸°ë°˜ ì‹¤ì‹œê°„ í™”ìƒ í†µí™” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë…ë¦½ëœ ì‹œê·¸ë„ë§ ì„œë²„ì™€ í•¨ê»˜ ë™ì‘í•©ë‹ˆë‹¤.

---

## ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| í™”ìƒ í†µí™” | WebRTC P2P ì—°ê²° |
| ìŒì„± í†µí™” | ì˜¤ë””ì˜¤ë§Œ ì „ì†¡ |
| í™”ë©´ ê³µìœ  | ë°ìŠ¤í¬í†±/ì• í”Œë¦¬ì¼€ì´ì…˜ ê³µìœ  |
| ìŒì†Œê±°/ë¹„ë””ì˜¤ ë„ê¸° | ë¯¸ë””ì–´ ì»¨íŠ¸ë¡¤ |
| ë‹¤ì¤‘ ì°¸ì—¬ì | ë©”ì‹œ í† í´ë¡œì§€ |

---

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Client A                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              VideoCallPage                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚VideoTileâ”‚ â”‚VideoTileâ”‚ â”‚VideoTileâ”‚                â”‚  â”‚
â”‚  â”‚  â”‚ (Self)  â”‚ â”‚(Peer 1) â”‚ â”‚(Peer 2) â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚           ControlBar             â”‚               â”‚  â”‚
â”‚  â”‚  â”‚ [ğŸ¤][ğŸ“¹][ğŸ–¥ï¸][âš™ï¸][ğŸ“]              â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                â”‚
â”‚                           â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Socket.io                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Signaling Server                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  video.js       â”‚  â”‚  presence.js    â”‚                 â”‚
â”‚  â”‚  - join-room    â”‚  â”‚  - online       â”‚                 â”‚
â”‚  â”‚  - offer/answer â”‚  â”‚  - offline      â”‚                 â”‚
â”‚  â”‚  - ice-candidateâ”‚  â”‚                 â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚            â”‚                                               â”‚
â”‚            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Redis Adapter                         â”‚  â”‚
â”‚  â”‚           (Multi-server support)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Client B   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Client C   â”‚
       â”‚   (P2P)     â”‚    WebRTC    â”‚   (P2P)     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## íŒŒì¼ êµ¬ì¡°

### í”„ë¡ íŠ¸ì—”ë“œ (coup)

```
coup/src/
â”œâ”€â”€ app/my-studies/[studyId]/video-call/
â”‚   â”œâ”€â”€ page.jsx              # í™”ìƒí†µí™” í™”ë©´
â”‚   â””â”€â”€ page.module.css       # ìŠ¤íƒ€ì¼
â””â”€â”€ components/video-call/
    â”œâ”€â”€ VideoTile.jsx         # ë¹„ë””ì˜¤ íƒ€ì¼
    â”œâ”€â”€ VideoTile.module.css
    â”œâ”€â”€ ControlBar.jsx        # ì»¨íŠ¸ë¡¤ ë°”
    â”œâ”€â”€ ControlBar.module.css
    â”œâ”€â”€ SettingsModal.jsx     # ì„¤ì • ëª¨ë‹¬
    â””â”€â”€ SettingsModal.module.css
```

### ì‹œê·¸ë„ë§ ì„œë²„

```
signaling-server/
â”œâ”€â”€ server.js                 # ë©”ì¸ ì„œë²„
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ video.js              # í™”ìƒí†µí™” ì´ë²¤íŠ¸
â”‚   â”œâ”€â”€ chat.js               # ì±„íŒ… ì´ë²¤íŠ¸
â”‚   â””â”€â”€ presence.js           # ì ‘ì† ìƒíƒœ ì´ë²¤íŠ¸
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.js               # ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.js             # ë¡œê¹…
â”œâ”€â”€ Dockerfile
â””â”€â”€ package.json
```

---

## WebRTC ì—°ê²° íë¦„

```
1. í´ë¼ì´ì–¸íŠ¸ A â†’ ì‹œê·¸ë„ë§: video:join-room
2. ì‹œê·¸ë„ë§ â†’ í´ë¼ì´ì–¸íŠ¸ A: video:room-state (ê¸°ì¡´ ì°¸ì—¬ì ëª©ë¡)
3. ì‹œê·¸ë„ë§ â†’ í´ë¼ì´ì–¸íŠ¸ B: video:user-joined (A ì…ì¥)
4. í´ë¼ì´ì–¸íŠ¸ A â†’ ì‹œê·¸ë„ë§ â†’ í´ë¼ì´ì–¸íŠ¸ B: video:offer
5. í´ë¼ì´ì–¸íŠ¸ B â†’ ì‹œê·¸ë„ë§ â†’ í´ë¼ì´ì–¸íŠ¸ A: video:answer
6. ì–‘ë°©í–¥ ICE candidate êµí™˜: video:ice-candidate
7. P2P ì—°ê²° ì™„ë£Œ
```

---

## Socket.io ì´ë²¤íŠ¸

### í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `video:join-room` | í™”ìƒ í†µí™” ë°© ì…ì¥ |
| `video:leave-room` | í™”ìƒ í†µí™” ë°© í‡´ì¥ |
| `video:offer` | WebRTC Offer ì „ì†¡ |
| `video:answer` | WebRTC Answer ì „ì†¡ |
| `video:ice-candidate` | ICE Candidate ì „ì†¡ |
| `video:toggle-audio` | ì˜¤ë””ì˜¤ í† ê¸€ |
| `video:toggle-video` | ë¹„ë””ì˜¤ í† ê¸€ |
| `video:start-screen-share` | í™”ë©´ ê³µìœ  ì‹œì‘ |
| `video:stop-screen-share` | í™”ë©´ ê³µìœ  ì¤‘ì§€ |

### ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `video:room-state` | í˜„ì¬ ë°© ìƒíƒœ |
| `video:user-joined` | ìƒˆ ì°¸ì—¬ì ì…ì¥ |
| `video:user-left` | ì°¸ì—¬ì í‡´ì¥ |
| `video:offer` | WebRTC Offer ìˆ˜ì‹  |
| `video:answer` | WebRTC Answer ìˆ˜ì‹  |
| `video:ice-candidate` | ICE Candidate ìˆ˜ì‹  |
| `video:media-state-changed` | ë¯¸ë””ì–´ ìƒíƒœ ë³€ê²½ |

---

## ê´€ë ¨ ë¬¸ì„œ

- [ì‹œê·¸ë„ë§ ì„œë²„](./signaling-server.md)
- [ì»´í¬ë„ŒíŠ¸](./components.md)
- [WebRTC ê°€ì´ë“œ](./webrtc.md)

