# ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ê°œìš”

CoUpì€ **Next.js ê¸°ë°˜ì˜ í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜**ìœ¼ë¡œ, HTTP/REST APIì™€ ì‹¤ì‹œê°„ WebSocket í†µì‹ ì„ ì§€ì›í•©ë‹ˆë‹¤. ë¶„ë¦¬í˜• ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ ë…ë¦½ì ì¸ í™•ì¥ê³¼ ì¥ì•  ê²©ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Client (Browser)                            â”‚
â”‚                    React 19 + Next.js 16 (SSR/CSR)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ HTTPS          â”‚                â”‚ WebSocket (Socket.IO)
          â–¼                â”‚                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js App   â”‚        â”‚       â”‚   Signaling     â”‚
â”‚  (Vercel/Docker)â”‚        â”‚       â”‚     Server      â”‚
â”‚                 â”‚        â”‚       â”‚  (Express.js)   â”‚
â”‚ â€¢ Frontend      â”‚        â”‚       â”‚                 â”‚
â”‚ â€¢ API Routes    â”‚        â”‚       â”‚ â€¢ ì±„íŒ…          â”‚
â”‚ â€¢ NextAuth      â”‚        â”‚       â”‚ â€¢ í™”ìƒí†µí™”      â”‚
â”‚ â€¢ Prisma ORM    â”‚        â”‚       â”‚ â€¢ ì•Œë¦¼          â”‚
â”‚ â€¢ Socket.IO     â”‚        â”‚       â”‚ â€¢ í”„ë ˆì¦ŒìŠ¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                â”‚
         â”‚ Prisma ORM      â”‚                â”‚
         â–¼                 â”‚                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”‚     Redis       â”‚
â”‚    Database     â”‚        â”‚       â”‚   (Pub/Sub)     â”‚
â”‚                 â”‚        â”‚       â”‚                 â”‚
â”‚ â€¢ 15ê°œ+ ëª¨ë¸    â”‚        â”‚       â”‚ â€¢ ë©”ì‹œì§€ ë™ê¸°í™” â”‚
â”‚ â€¢ ê´€ê³„í˜• ë°ì´í„° â”‚        â”‚       â”‚ â€¢ ì„¸ì…˜ ìºì‹œ     â”‚
â”‚ â€¢ ë§ˆì´ê·¸ë ˆì´ì…˜  â”‚        â”‚       â”‚ â€¢ ìˆ˜í‰ í™•ì¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚   AWS S3    â”‚
                    â”‚  (Files)    â”‚
                    â”‚   [ê³„íš]    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì„œë¹„ìŠ¤ êµ¬ì„±

### 1. Next.js Application (í¬íŠ¸ 3000)

ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤.

| ì—­í•  | ì„¤ëª… |
|------|------|
| **Frontend** | React 19 + Next.js 16 App Router |
| **API Routes** | RESTful API ì—”ë“œí¬ì¸íŠ¸ |
| **NextAuth** | ì¸ì¦/ì¸ê°€ ì²˜ë¦¬ |
| **Prisma ORM** | ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ |
| **Socket.IO Server** | ì‹¤ì‹œê°„ í†µì‹  (ë‚´ì¥) |

**íŒŒì¼ ìœ„ì¹˜:**
- ì„œë²„ ì—”íŠ¸ë¦¬: `coup/server.mjs`
- Socket.IO: `coup/src/lib/socket/server.js`
- API Routes: `coup/src/app/api/`

### 2. Signaling Server (í¬íŠ¸ 4000)

ë³„ë„ì˜ ì‹¤ì‹œê°„ í†µì‹  ì „ìš© ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

| ì—­í•  | ì„¤ëª… |
|------|------|
| **í™”ìƒí†µí™”** | WebRTC Signaling |
| **ì±„íŒ…** | ì‹¤ì‹œê°„ ë©”ì‹œì§€ |
| **í”„ë ˆì¦ŒìŠ¤** | ì˜¨ë¼ì¸ ìƒíƒœ ê´€ë¦¬ |
| **ì•Œë¦¼** | ì‹¤ì‹œê°„ ì•Œë¦¼ ì „ì†¡ |

**íŒŒì¼ ìœ„ì¹˜:**
- ì„œë²„ ì—”íŠ¸ë¦¬: `signaling-server/server.js`
- í•¸ë“¤ëŸ¬: `signaling-server/handlers/`
- ì¸ì¦ ë¯¸ë“¤ì›¨ì–´: `signaling-server/middleware/auth.js`

### 3. PostgreSQL Database (í¬íŠ¸ 5432)

ê´€ê³„í˜• ë°ì´í„° ì €ì¥ì†Œì…ë‹ˆë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë²„ì „** | 15 (Alpine) |
| **ORM** | Prisma 6 |
| **ëª¨ë¸ ìˆ˜** | 15ê°œ+ |
| **ìŠ¤í‚¤ë§ˆ** | `coup/prisma/schema.prisma` |

### 4. Redis (í¬íŠ¸ 6379)

ì¸ë©”ëª¨ë¦¬ ë°ì´í„° ìŠ¤í† ì–´ë¡œ ì‹¤ì‹œê°„ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.

| ìš©ë„ | ì„¤ëª… |
|------|------|
| **Pub/Sub** | ë©€í‹°ì„œë²„ Socket.IO ë™ê¸°í™” |
| **ìºì‹œ** | ì„¸ì…˜ ë° ì„ì‹œ ë°ì´í„° |
| **Adapter** | @socket.io/redis-adapter |

---

## ìš”ì²­ íë¦„

### HTTP/REST ìš”ì²­ íë¦„

```
Browser â†’ Next.js â†’ API Route Handler â†’ Prisma â†’ PostgreSQL
                          â†“
                    NextAuth (ì¸ì¦)
                          â†“
                    Response â†’ Browser
```

### ì‹¤ì‹œê°„ í†µì‹  íë¦„

```
Browser â†’ Socket.IO Client â†’ Next.js Socket Server â†’ Redis Pub/Sub
                                       â†“
                              Prisma (ë©”ì‹œì§€ ì €ì¥)
                                       â†“
                              PostgreSQL â†’ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸
```

### í™”ìƒí†µí™” Signaling íë¦„

```
Browser A â†’ Signaling Server â†’ Redis Pub/Sub â†’ Browser B
                â†“
        WebRTC Offer/Answer
        ICE Candidates
```

---

## ì¸ì¦ ì•„í‚¤í…ì²˜

### NextAuth ê¸°ë°˜ ì¸ì¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚â”€â”€â”€â–¶â”‚   NextAuth   â”‚â”€â”€â”€â–¶â”‚   Prisma     â”‚
â”‚              â”‚    â”‚              â”‚    â”‚   Adapter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚                   â–¼                   â–¼
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚            â”‚   Session    â”‚    â”‚  PostgreSQL  â”‚
       â”‚            â”‚   Cookie     â”‚    â”‚   (User)     â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Middleware                  â”‚
â”‚  (Route Protection, Admin Check)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì¸ì¦ ì œê³µì

| Provider | ìƒíƒœ |
|----------|------|
| **Credentials** | âœ… í™œì„± |
| **Google OAuth** | âœ… í™œì„± |
| **GitHub OAuth** | âœ… í™œì„± |

**ê´€ë ¨ íŒŒì¼:**
- NextAuth ì„¤ì •: `coup/src/lib/auth.js`
- ë¯¸ë“¤ì›¨ì–´: `coup/middleware.js`
- Auth Helpers: `coup/src/lib/auth-helpers.js`

---

## Socket.IO ì•„í‚¤í…ì²˜

### ë“€ì–¼ Socket ì„œë²„ êµ¬ì¡°

CoUpì€ ë‘ ê°œì˜ Socket.IO ì„œë²„ë¥¼ ìš´ì˜í•©ë‹ˆë‹¤:

| ì„œë²„ | í¬íŠ¸ | ìš©ë„ |
|------|------|------|
| **Next.js ë‚´ì¥** | 3000 | ì±„íŒ…, ì•Œë¦¼ |
| **Signaling Server** | 4000 | í™”ìƒí†µí™”, í”„ë ˆì¦ŒìŠ¤ |

### Redis Adapter êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Redis Pub/Sub                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Server A      â”‚   Server B      â”‚   Signaling     â”‚
â”‚   (Next.js)     â”‚   (Next.js)     â”‚   Server        â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚ [Socket.IO]     â”‚ [Socket.IO]     â”‚ [Socket.IO]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
         â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Client1 â”‚       â”‚ Client2 â”‚       â”‚ Client3 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì´ë²¤íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤

| ì´ë²¤íŠ¸ ê·¸ë£¹ | ì ‘ë‘ì‚¬ | ì˜ˆì‹œ |
|-------------|--------|------|
| **ì±„íŒ…** | `chat:` | `chat:message`, `chat:typing` |
| **ì•Œë¦¼** | `notification:` | `notification:new` |
| **í™”ìƒí†µí™”** | `video:` | `video:offer`, `video:answer` |
| **í”„ë ˆì¦ŒìŠ¤** | `presence:` | `presence:online` |
| **ìŠ¤í„°ë””** | `study:` | `study:join`, `study:leave` |

---

## ë°ì´í„° íë¦„

### ìŠ¤í„°ë”” ê°€ì… ìš”ì²­ íë¦„

```
1. ì‚¬ìš©ì â†’ [POST /api/studies/{id}/join] â†’ API Route
2. API Route â†’ [ì¸ì¦ í™•ì¸] â†’ NextAuth
3. API Route â†’ [ë°ì´í„° ìƒì„±] â†’ Prisma â†’ PostgreSQL
4. API Route â†’ [ì•Œë¦¼ ì „ì†¡] â†’ Socket.IO â†’ Redis Pub/Sub
5. Redis â†’ [ë¸Œë¡œë“œìºìŠ¤íŠ¸] â†’ ìŠ¤í„°ë”” ì˜¤ë„ˆ
6. Response â†’ ì‚¬ìš©ì
```

### ì±„íŒ… ë©”ì‹œì§€ íë¦„

```
1. ì‚¬ìš©ì A â†’ [Socket.IO emit] â†’ Next.js Socket Server
2. Server â†’ [ë©”ì‹œì§€ ì €ì¥] â†’ Prisma â†’ PostgreSQL
3. Server â†’ [ë¸Œë¡œë“œìºìŠ¤íŠ¸] â†’ Redis Pub/Sub
4. Redis â†’ [ë‹¤ë¥¸ ì„œë²„] â†’ ìŠ¤í„°ë”” ë£¸ ë©¤ë²„ë“¤
5. ì‚¬ìš©ì B, C, D â†’ [ë©”ì‹œì§€ ìˆ˜ì‹ ]
```

---

## í•µì‹¬ ì„¤ê³„ ì›ì¹™

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **ë¶„ë¦¬í˜• ì•„í‚¤í…ì²˜** | HTTPì™€ WebSocket ì„œë²„ ë¶„ë¦¬ë¡œ ë…ë¦½ í™•ì¥ |
| **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤** | ê° ì„œë¹„ìŠ¤ì˜ ë…ë¦½ì  ë°°í¬ ê°€ëŠ¥ |
| **ì‹¤ì‹œê°„ í†µì‹ ** | Socket.IO + Redisë¡œ ë©€í‹°ì„œë²„ ì§€ì› |
| **ìŠ¤ì¼€ì¼ëŸ¬ë¸”** | Redis Pub/Subë¥¼ í†µí•œ ìˆ˜í‰ í™•ì¥ |
| **ì¥ì•  ê²©ë¦¬** | ì„œë¹„ìŠ¤ ê°„ ì¥ì•  ì „íŒŒ ë°©ì§€ |

---

## í™•ì¥ ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Load       â”‚
                    â”‚   Balancer   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Next.js  â”‚    â”‚ Next.js  â”‚    â”‚ Next.js  â”‚
    â”‚    #1    â”‚    â”‚    #2    â”‚    â”‚    #3    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    Redis     â”‚
                  â”‚   Cluster    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í–¥í›„ í™•ì¥ ê³„íš

| ê¸°ëŠ¥ | ê¸°ìˆ  | ìƒíƒœ |
|------|------|------|
| **íŒŒì¼ ìŠ¤í† ë¦¬ì§€** | AWS S3 | ê³„íš |
| **CDN** | CloudFront | ê³„íš |
| **ê²€ìƒ‰** | Elasticsearch | ê³„íš |
| **ëª¨ë‹ˆí„°ë§** | Grafana + Prometheus | ê³„íš |

---

## ê´€ë ¨ ë¬¸ì„œ

- [í´ë” êµ¬ì¡°](./folder-structure.md) - í”„ë¡œì íŠ¸ ë””ë ‰í„°ë¦¬ êµ¬ì„±
- [ê¸°ìˆ  ìŠ¤íƒ](./tech-stack.md) - ì‚¬ìš© ê¸°ìˆ  ìƒì„¸
- [ë°°í¬](./deployment.md) - í™˜ê²½ ì„¤ì • ë° ë°°í¬
- [Socket.IO ì„¤ì •](../19-infrastructure/realtime-socket.md) - ì‹¤ì‹œê°„ í†µì‹  ìƒì„¸

